{"version":3,"sources":["../../src/cli/commands/build.ts","../../src/cli/commands/export.ts","../../src/cli/index.ts"],"names":["args","resolve","readFileSync","writeFileSync"],"mappings":";;;;;;;;;;;;;;;AAMO,SAAS,YAAA,CAAaA,OAAgB,GAAA,EAAmB;AAC9D,EAAA,IAAI,UAAA,GAAa,mBAAA;AACjB,EAAA,IAAI,OAAA,GAAU,WAAA;AACd,EAAA,IAAI,OAAA,GAAU,KAAA;AAEd,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAIA,KAAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AACpC,IAAA,MAAM,OAAA,GAAUA,KAAAA,CAAK,CAAA,GAAI,CAAC,CAAA;AAC1B,IAAA,IAAIA,KAAAA,CAAK,CAAC,CAAA,KAAM,UAAA,IAAc,OAAA,EAAS;AACrC,MAAA,UAAA,GAAa,OAAA;AACb,MAAA,CAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAWA,KAAAA,CAAK,CAAC,CAAA,KAAM,WAAW,OAAA,EAAS;AACzC,MAAA,OAAA,GAAU,OAAA;AACV,MAAA,CAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAWA,KAAAA,CAAK,CAAC,CAAA,KAAM,SAAA,EAAW;AAChC,MAAA,OAAA,GAAU,IAAA;AAAA,IACZ;AAAA,EACF;AAEA,EAAA,MAAM,aAAA,GAAgB,OAAA,CAAQ,GAAA,EAAK,UAAU,CAAA;AAC7C,EAAA,MAAM,UAAA,GAAa,OAAA,CAAQ,GAAA,EAAK,OAAO,CAAA;AAEvC,EAAA,MAAM,QAAQ,MAAY;AACxB,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAwB,aAAa,CAAA,CAAE,CAAA;AACnD,IAAA,IAAI,MAAA;AACJ,IAAA,IAAI;AACF,MAAA,MAAA,GAAS,IAAA,CAAK,KAAA,CAAM,YAAA,CAAa,aAAA,EAAe,MAAM,CAAC,CAAA;AAAA,IACzD,SAAS,CAAA,EAAG;AACV,MAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,2BAAA,EAA8B,MAAA,CAAO,CAAC,CAAC,CAAA,CAAE,CAAA;AACvD,MAAA,IAAI,CAAC,OAAA,EAAS,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAA;AAC5B,MAAA;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,IAAI,qBAAqB,CAAA;AACjC,IAAA,MAAM,KAAA,GAAQ,MAAM,MAAM,CAAA;AAE1B,IAAA,OAAA,CAAQ,IAAI,mBAAmB,CAAA;AAC/B,IAAA,IAAI,GAAA,GAAM,iBAAA;AAAA,MACR,MAAA,CAAO,MAAA;AAAA,MACP,KAAA;AAAA,MACA,MAAA,CAAO,aAAA;AAAA,MACP;AAAA,KACF;AAEA,IAAA,MAAM,KAAA,GAAQ,gBAAA,CAAiB,MAAA,CAAO,OAAA,CAAQ,SAAS,CAAA;AACvD,IAAA,IACE,KAAA,CAAM,WAAW,MAAA,IACjB,KAAA,CAAM,QAAQ,MAAA,IACd,KAAA,CAAM,cAAc,MAAA,EACpB;AACA,MAAA,MAAM,OAAiB,EAAC;AACxB,MAAA,IAAI,MAAM,MAAA,KAAW,MAAA;AACnB,QAAA,IAAA,CAAK,IAAA,CAAK,CAAA,kBAAA,EAAqB,KAAA,CAAM,MAAM,CAAA,CAAA,CAAG,CAAA;AAChD,MAAA,IAAI,KAAA,CAAM,QAAQ,MAAA,EAAW,IAAA,CAAK,KAAK,CAAA,eAAA,EAAkB,KAAA,CAAM,GAAG,CAAA,CAAA,CAAG,CAAA;AACrE,MAAA,IAAI,MAAM,SAAA,KAAc,MAAA;AACtB,QAAA,IAAA,CAAK,IAAA,CAAK,CAAA,qBAAA,EAAwB,KAAA,CAAM,SAAS,CAAA,CAAA,CAAG,CAAA;AAEtD,MAAA,IAAI,IAAA,CAAK,SAAS,CAAA,EAAG;AACnB,QAAA,GAAA,GAAM,CAAA;AAAA,EAAY,IAAA,CAAK,IAAA,CAAK,IAAI,CAAC;AAAA;;AAAA,CAAA,GAAY,GAAA;AAAA,MAC/C;AAAA,IACF;AAGA,IAAA,OAAA,CAAQ,IAAI,qCAAqC,CAAA;AACjD,IAAA,MAAM,QAAA,GAAW,eAAe,MAAM,CAAA;AACtC,IAAA,MAAM,OAAA,GAAU,MAAM,QAAQ,CAAA;AAC9B,IAAA,MAAM,KAAA,GAAQ,iBAAA;AAAA,MACZ,QAAA,CAAS,MAAA;AAAA,MACT,OAAA;AAAA,MACA,QAAA,CAAS,aAAA;AAAA,MACT;AAAA,KACF;AAGA,IAAA,MAAM,OAAA,GAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,EASlB,KAAK;AAAA;AAAA,CAAA;AAIH,IAAA,GAAA,IAAO,OAAA;AAEP,IAAA,OAAA,CAAQ,GAAA,CAAI,mBAAmB,UAAU,CAAA;AACzC,IAAA,aAAA,CAAc,YAAY,GAAG,CAAA;AAC7B,IAAA,OAAA,CAAQ,IAAI,OAAO,CAAA;AAAA,EACrB,CAAA;AAEA,EAAA,KAAA,EAAM;AAEN,EAAA,IAAI,OAAA,EAAS;AACX,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,wBAAA,EAA2B,aAAa,CAAA,GAAA,CAAK,CAAA;AACzD,IAAA,KAAA,CAAM,aAAA,EAAe,CAAC,SAAA,KAAc;AAClC,MAAA,IAAI,cAAc,QAAA,EAAU;AAC1B,QAAA,OAAA,CAAQ,IAAI,+BAA+B,CAAA;AAC3C,QAAA,KAAA,EAAM;AAAA,MACR;AAAA,IACF,CAAC,CAAA;AAAA,EACH;AACF;ACvGO,SAAS,aAAA,CAAcA,OAAgB,GAAA,EAAmB;AAI/D,EAAA,IAAI,UAAA,GAAa,mBAAA;AACjB,EAAA,IAAI,OAAA,GAAU,EAAA;AACd,EAAA,IAAI,MAAA,GAAS,MAAA;AAEb,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAIA,KAAAA,CAAK,QAAQ,CAAA,EAAA,EAAK;AACpC,IAAA,MAAM,OAAA,GAAUA,KAAAA,CAAK,CAAA,GAAI,CAAC,CAAA;AAC1B,IAAA,IAAIA,KAAAA,CAAK,CAAC,CAAA,KAAM,UAAA,IAAc,OAAA,EAAS;AACrC,MAAA,UAAA,GAAa,OAAA;AACb,MAAA,CAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAWA,KAAAA,CAAK,CAAC,CAAA,KAAM,WAAW,OAAA,EAAS;AACzC,MAAA,OAAA,GAAU,OAAA;AACV,MAAA,CAAA,EAAA;AAAA,IACF,CAAA,MAAA,IAAWA,KAAAA,CAAK,CAAC,CAAA,KAAM,cAAc,OAAA,EAAS;AAC5C,MAAA,MAAA,GAAS,OAAA;AACT,MAAA,CAAA,EAAA;AAAA,IACF;AAAA,EACF;AAGA,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,IAAI,WAAW,MAAA,EAAQ;AACrB,MAAA,OAAA,GAAU,aAAA;AAAA,IACZ,CAAA,MAAA,IAAW,WAAW,UAAA,EAAY;AAChC,MAAA,OAAA,GAAU,oBAAA;AAAA,IACZ;AAAA,EACF;AAEA,EAAA,MAAM,aAAA,GAAgBC,OAAAA,CAAQ,GAAA,EAAK,UAAU,CAAA;AAC7C,EAAA,MAAM,UAAA,GAAaA,OAAAA,CAAQ,GAAA,EAAK,OAAO,CAAA;AAEvC,EAAA,IAAI,MAAA,KAAW,MAAA,IAAU,MAAA,KAAW,UAAA,EAAY;AAC9C,IAAA,OAAA,CAAQ,KAAA;AAAA,MACN,8BAA8B,MAAM,CAAA,yCAAA;AAAA,KACtC;AACA,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AAEA,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,qBAAA,EAAwB,aAAa,CAAA,CAAE,CAAA;AACnD,EAAA,IAAI,MAAA;AACJ,EAAA,IAAI;AACF,IAAA,MAAA,GAAS,IAAA,CAAK,KAAA,CAAMC,YAAAA,CAAa,aAAA,EAAe,MAAM,CAAC,CAAA;AAAA,EACzD,SAAS,CAAA,EAAG;AACV,IAAA,OAAA,CAAQ,KAAA,CAAM,CAAA,2BAAA,EAA8B,MAAA,CAAO,CAAC,CAAC,CAAA,CAAE,CAAA;AACvD,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB;AAEA,EAAA,OAAA,CAAQ,IAAI,kBAAkB,CAAA;AAC9B,EAAA,MAAM,KAAA,GAAQ,MAAM,MAAM,CAAA;AAE1B,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,aAAA,EAAgB,MAAA,CAAO,WAAA,EAAa,CAAA,GAAA,CAAK,CAAA;AACrD,EAAA,IAAI,aAAA,GAAgB,EAAA;AAEpB,EAAA,IAAI,WAAW,MAAA,EAAQ;AACrB,IAAA,MAAM,MAAA,GAAS,OAAO,KAAK,CAAA;AAC3B,IAAA,aAAA,GAAgB,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAA;AAAA,EAChD,CAAA,MAAA,IAAW,WAAW,UAAA,EAAY;AAChC,IAAA,MAAM,MAAA,GAAS,WAAW,KAAK,CAAA;AAE/B,IAAA,aAAA,GAAgB,oBAAoB,IAAA,CAAK,SAAA,CAAU,MAAA,EAAQ,IAAA,EAAM,CAAC,CAAC,CAAA,CAAA,CAAA;AAAA,EACrE;AAEA,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,YAAA,EAAe,UAAU,CAAA,CAAE,CAAA;AACvC,EAAAC,aAAAA,CAAc,YAAY,aAAa,CAAA;AACvC,EAAA,OAAA,CAAQ,IAAI,OAAO,CAAA;AACrB;;;ACnEA,IAAM,IAAA,GAAO,OAAA,CAAQ,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA;AACjC,IAAM,GAAA,GAAM,QAAQ,GAAA,EAAI;AAExB,IAAM,SAAS,OAAA,CAAQ,IAAA,CAAK,CAAC,CAAA,KAAM,aAAA,CAAc,YAAY,GAAG,CAAA;AAEhE,IAAI,MAAA,EAAQ;AACV,EAAA,MAAM,OAAA,GAAU,KAAK,CAAC,CAAA;AAEtB,EAAA,IAAI,YAAY,MAAA,EAAQ;AACtB,IAAA,MAAM,UAAA,GAAa,IAAA,CAAK,GAAA,EAAK,mBAAmB,CAAA;AAChD,IAAA,IAAI,UAAA,CAAW,UAAU,CAAA,EAAG;AAC1B,MAAA,OAAA,CAAQ,MAAM,0CAA0C,CAAA;AACxD,MAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,IAChB;AACA,IAAA,MAAM,gBAAA,GAAmB;AAAA,MACvB,OAAA,EACE,uEAAA;AAAA,MACF,GAAG;AAAA,KACL;AACA,IAAAA,cAAc,UAAA,EAAY,IAAA,CAAK,UAAU,gBAAA,EAAkB,IAAA,EAAM,CAAC,CAAC,CAAA;AACnE,IAAA,OAAA,CAAQ,IAAI,2BAA2B,CAAA;AAEvC,IAAA,IAAI,CAAC,UAAA,CAAW,IAAA,CAAK,GAAA,EAAK,cAAc,CAAC,CAAA,EAAG;AAC1C,MAAA,OAAA,CAAQ,IAAA;AAAA,QACN;AAAA,OACF;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,IAAI,kDAAkD,CAAA;AAC9D,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB,CAAA,MAAA,IAAW,YAAY,QAAA,EAAU;AAC/B,IAAA,aAAA,CAAc,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA,EAAG,GAAG,CAAA;AAChC,IAAA,OAAA,CAAQ,KAAK,CAAC,CAAA;AAAA,EAChB,CAAA,MAAA,IAAW,YAAY,OAAA,EAAS;AAC9B,IAAA,YAAA,CAAa,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA,EAAG,GAAG,CAAA;AAAA,EACjC,WAAW,OAAA,IAAW,CAAC,OAAA,CAAQ,UAAA,CAAW,GAAG,CAAA,EAAG;AAE9C,IAAA,MAAM,MAAA,GAAS,KAAK,CAAC,CAAA;AACrB,IAAA,MAAM,GAAA,GAAM,KAAK,CAAC,CAAA;AAClB,IAAA,MAAM,UAAoB,EAAC;AAC3B,IAAA,IAAI,MAAA,EAAQ,OAAA,CAAQ,IAAA,CAAK,UAAA,EAAY,MAAM,CAAA;AAC3C,IAAA,IAAI,GAAA,EAAK,OAAA,CAAQ,IAAA,CAAK,OAAA,EAAS,GAAG,CAAA;AAElC,IAAA,YAAA,CAAa,SAAS,GAAG,CAAA;AAAA,EAC3B,CAAA,MAAO;AAGL,IAAA,YAAA,CAAa,MAAM,GAAG,CAAA;AAAA,EACxB;AACF","file":"index.js","sourcesContent":["import { readFileSync, watch, writeFileSync } from \"node:fs\";\nimport { resolve } from \"node:path\";\nimport { generateTokensCss, toHighContrast } from \"../../lib/generator.ts\";\nimport { getKeyColorStats, solve } from \"../../lib/index.ts\";\nimport type { SolverConfig } from \"../../lib/types.ts\";\n\nexport function buildCommand(args: string[], cwd: string): void {\n  let configPath = \"color-config.json\";\n  let outPath = \"theme.css\";\n  let isWatch = false;\n\n  for (let i = 0; i < args.length; i++) {\n    const nextArg = args[i + 1];\n    if (args[i] === \"--config\" && nextArg) {\n      configPath = nextArg;\n      i++;\n    } else if (args[i] === \"--out\" && nextArg) {\n      outPath = nextArg;\n      i++;\n    } else if (args[i] === \"--watch\") {\n      isWatch = true;\n    }\n  }\n\n  const absConfigPath = resolve(cwd, configPath);\n  const absOutPath = resolve(cwd, outPath);\n\n  const build = (): void => {\n    console.log(`Reading config from: ${absConfigPath}`);\n    let config: SolverConfig;\n    try {\n      config = JSON.parse(readFileSync(absConfigPath, \"utf8\")) as SolverConfig;\n    } catch (e) {\n      console.error(`Error reading config file: ${String(e)}`);\n      if (!isWatch) process.exit(1);\n      return;\n    }\n\n    console.log(\"Solving surfaces...\");\n    const theme = solve(config);\n\n    console.log(\"Generating CSS...\");\n    let css = generateTokensCss(\n      config.groups,\n      theme,\n      config.borderTargets,\n      undefined\n    );\n\n    const stats = getKeyColorStats(config.anchors.keyColors);\n    if (\n      stats.chroma !== undefined ||\n      stats.hue !== undefined ||\n      stats.lightness !== undefined\n    ) {\n      const vars: string[] = [];\n      if (stats.chroma !== undefined)\n        vars.push(`  --chroma-brand: ${stats.chroma};`);\n      if (stats.hue !== undefined) vars.push(`  --hue-brand: ${stats.hue};`);\n      if (stats.lightness !== undefined)\n        vars.push(`  --lightness-brand: ${stats.lightness};`);\n\n      if (vars.length > 0) {\n        css = `:root {\\n${vars.join(\"\\n\")}\\n}\\n\\n` + css;\n      }\n    }\n\n    // --- High Contrast Generation ---\n    console.log(\"Generating High Contrast variant...\");\n    const hcConfig = toHighContrast(config);\n    const hcTheme = solve(hcConfig);\n    const hcCss = generateTokensCss(\n      hcConfig.groups,\n      hcTheme,\n      hcConfig.borderTargets,\n      undefined\n    );\n\n    // Wrap in media query and add overrides\n    const hcBlock = `\n@media (prefers-contrast: more) {\n  :root {\n    --base-chroma: 0;\n    --surface-chroma-adjust: 0;\n    --hue-adjust: 0;\n    --chroma-brand: 0;\n  }\n\n${hcCss}\n}\n`;\n\n    css += hcBlock;\n\n    console.log(\"Writing CSS to:\", absOutPath);\n    writeFileSync(absOutPath, css);\n    console.log(\"Done!\");\n  };\n\n  build();\n\n  if (isWatch) {\n    console.log(`Watching for changes in ${absConfigPath}...`);\n    watch(absConfigPath, (eventType) => {\n      if (eventType === \"change\") {\n        console.log(\"Config changed, rebuilding...\");\n        build();\n      }\n    });\n  }\n}\n","import { readFileSync, writeFileSync } from \"node:fs\";\nimport { resolve } from \"node:path\";\nimport { toDTCG } from \"../../lib/exporters/dtcg.ts\";\nimport { toTailwind } from \"../../lib/exporters/tailwind.ts\";\nimport { solve } from \"../../lib/index.ts\";\nimport type { SolverConfig } from \"../../lib/types.ts\";\n\nexport function exportCommand(args: string[], cwd: string): void {\n  // Simple arg parsing\n  // color-system export --config <file> --out <file> --format <format>\n\n  let configPath = \"color-config.json\";\n  let outPath = \"\"; // Will be set based on format if not provided\n  let format = \"dtcg\";\n\n  for (let i = 0; i < args.length; i++) {\n    const nextArg = args[i + 1];\n    if (args[i] === \"--config\" && nextArg) {\n      configPath = nextArg;\n      i++;\n    } else if (args[i] === \"--out\" && nextArg) {\n      outPath = nextArg;\n      i++;\n    } else if (args[i] === \"--format\" && nextArg) {\n      format = nextArg;\n      i++;\n    }\n  }\n\n  // Set default output path if not provided\n  if (!outPath) {\n    if (format === \"dtcg\") {\n      outPath = \"tokens.json\";\n    } else if (format === \"tailwind\") {\n      outPath = \"tailwind.preset.js\";\n    }\n  }\n\n  const absConfigPath = resolve(cwd, configPath);\n  const absOutPath = resolve(cwd, outPath);\n\n  if (format !== \"dtcg\" && format !== \"tailwind\") {\n    console.error(\n      `Error: Unsupported format '${format}'. Supported formats: 'dtcg', 'tailwind'.`\n    );\n    process.exit(1);\n  }\n\n  console.log(`Reading config from: ${absConfigPath}`);\n  let config: SolverConfig;\n  try {\n    config = JSON.parse(readFileSync(absConfigPath, \"utf8\")) as SolverConfig;\n  } catch (e) {\n    console.error(`Error reading config file: ${String(e)}`);\n    process.exit(1);\n  }\n\n  console.log(\"Solving theme...\");\n  const theme = solve(config);\n\n  console.log(`Exporting to ${format.toUpperCase()}...`);\n  let outputContent = \"\";\n\n  if (format === \"dtcg\") {\n    const tokens = toDTCG(theme);\n    outputContent = JSON.stringify(tokens, null, 2);\n  } else if (format === \"tailwind\") {\n    const preset = toTailwind(theme);\n    // Output as CommonJS module\n    outputContent = `module.exports = ${JSON.stringify(preset, null, 2)};`;\n  }\n\n  console.log(`Writing to: ${absOutPath}`);\n  writeFileSync(absOutPath, outputContent);\n  console.log(\"Done!\");\n}\n","#!/usr/bin/env node\nimport { existsSync, writeFileSync } from \"node:fs\";\nimport { join } from \"node:path\";\nimport { fileURLToPath } from \"node:url\";\nimport { buildCommand } from \"./commands/build.ts\";\nimport { exportCommand } from \"./commands/export.ts\";\nimport { DEFAULT_CONFIG } from \"./default-config.ts\";\n\nconst args = process.argv.slice(2);\nconst CWD = process.cwd();\n\nconst isMain = process.argv[1] === fileURLToPath(import.meta.url);\n\nif (isMain) {\n  const command = args[0];\n\n  if (command === \"init\") {\n    const targetPath = join(CWD, \"color-config.json\");\n    if (existsSync(targetPath)) {\n      console.error(\"Error: color-config.json already exists.\");\n      process.exit(1);\n    }\n    const configWithSchema = {\n      $schema:\n        \"node_modules/@algebraic-systems/color-system/color-config.schema.json\",\n      ...DEFAULT_CONFIG,\n    };\n    writeFileSync(targetPath, JSON.stringify(configWithSchema, null, 2));\n    console.log(\"Created color-config.json\");\n    \n    if (!existsSync(join(CWD, \"node_modules\"))) {\n      console.warn(\n        \"Note: node_modules not found in current directory. You may need to adjust the $schema path.\"\n      );\n    }\n\n    console.log(\"Run `color-system build` to generate your theme.\");\n    process.exit(0);\n  } else if (command === \"export\") {\n    exportCommand(args.slice(1), CWD);\n    process.exit(0);\n  } else if (command === \"build\") {\n    buildCommand(args.slice(1), CWD);\n  } else if (command && !command.startsWith(\"-\")) {\n    // Legacy/Default behavior: color-system <config> <out>\n    const config = args[0];\n    const out = args[1];\n    const newArgs: string[] = [];\n    if (config) newArgs.push(\"--config\", config);\n    if (out) newArgs.push(\"--out\", out);\n\n    buildCommand(newArgs, CWD);\n  } else {\n    // Default: just run build with passed args (flags)\n    // e.g. color-system --watch\n    buildCommand(args, CWD);\n  }\n}\n"]}